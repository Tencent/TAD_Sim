This guide provides the official workflow for building, packaging, and deploying **TAD_Sim** to a new system (offline or online).

---

## ðŸ› ï¸ System Requirements (Ubuntu)

To ensure the app launches on a fresh system, the host machine must have these packages installed:

### 1. For Developers (To BUILD the project)
-   **Docker** (Required to run the build environment)
-   **Git & Git-LFS** (To clone the repository and download binaries)
```bash
sudo apt-get install docker.io git git-lfs
```

### 2. For Users (To RUN the application)
Most systems (Desktop Ubuntu/CentOS/Debian) already have these. However, if you are using a **Headless Server** or a **Minimal/Core** installation, you must ensure these are installed before going offline:
```bash
sudo apt-get install gconf2 libnss3 libatk1.0-0 libatk-bridge2.0-0 libcups2 libdrm2 libgbm1 libasound2 libxcomposite1 libxdamage1 libxrandr2
```
> [!NOTE]
> These are **system-level gui libraries** that interface with your screen and mouse. They are **NOT included in the `tadsim_portable_linux_x64.tar.gz` package** because they are tied to your specific Linux kernel/desktop version.

---

## Part 1: Build & Package (On Developer/Docker Machine)

Follow these steps to generate a "clean" portable package:

1.  **Enter the Docker Container:**
    ```bash
    docker run -it --rm --network host -v "$(pwd)":/build -w /build tadsim/desktop:v1.0 /bin/bash
    ```
2.  **Run the Build:**
    ```bash
    ./build.sh
    ```
3.  **Find your Artifact:**
    Your portable package is located at:
    `./build/tadsim_portable_linux_x64.tar.gz`

---

## Part 2: Deployment (On Target/User Machine)

1.  **Transfer & Unpack:**
    Copy the `.tar.gz` file to the target machine. Since the archive contains files at its root, it is recommended to extract it into a dedicated folder:
    ```bash
    mkdir tadsim_portable
    tar -zxvf tadsim_portable_linux_x64.tar.gz -C tadsim_portable
    cd tadsim_portable
    ```

2.  **First-Run Setup (CRITICAL):**
    Run the deployment helper script. This handles all directory initialization and library compatibility fixes automatically:
    ```bash
    bash resources/app/service/deploy_runtime.sh
    ```
    *Output should say:* `Runtime environment initialized. You can now run tadsim.`

3.  **Launch the App:**
    ```bash
    ./tadsim
    ```

---

## ðŸ§¹ How to Reset / Reinstall (Start from Scratch)
If you encounter persistent "Error Code 2" or need to perform a fresh installation, run these commands **on the target machine** before extracting the new package:

1.  **Stop all processes:**
    ```bash
    pkill -f txsim
    pkill -f txSimService
    ```
2.  **Wipe the configuration:**
    ```bash
    rm -rf ~/.config/tadsim
    ```
3.  **Remove old files (Optional):**
    ```bash
    rm -rf path/to/old/tadsim_folder
    ```
    *Now you can proceed to [Part 2: Deployment](#part-2-deployment-on-targetuser-machine) for a clean install.*

---

## Summary of Automatic Fixes
The `deploy_runtime.sh` script (generated by `build.sh`) now automatically performs:
-   **Directory Creation:** Sets up `~/.config/tadsim` with the correct subfolders (`sys/scenario`, `data/scenario`, etc.).
-   **Asset Migration:** Forcibly copies the latest 3D models and catalogs to the user directory.
-   **Library Patching:** Renames the bundled `libgcc_s.so.1` to avoid crashes with newer system `libstdc++` (GCC version mismatches).

---
**Application is now fully robust and portable.**
